<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yepit.flow.bo.BusMilestoneMapper">
  <resultMap id="BaseResultMap" type="com.yepit.flow.bo.BusMilestone">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="bus_id" jdbcType="BIGINT" property="busId" />
    <result column="task_id" jdbcType="VARCHAR" property="taskId" />
    <result column="task_def_id" jdbcType="VARCHAR" property="taskDefId" />
    <result column="current_task" jdbcType="VARCHAR" property="currentTask" />
    <result column="assigement_user" jdbcType="BIGINT" property="assigementUser" />
    <result column="assigement_user_name" jdbcType="VARCHAR" property="assigementUserName" />
    <result column="done_result" jdbcType="VARCHAR" property="doneResult" />
    <result column="done_remark" jdbcType="VARCHAR" property="doneRemark" />
    <result column="start_date" jdbcType="TIMESTAMP" property="startDate" />
    <result column="end_date" jdbcType="TIMESTAMP" property="endDate" />
    <result column="status" jdbcType="VARCHAR" property="status" />
  </resultMap>

  <resultMap id="PageSearchResultMap" type="com.yepit.flow.dto.BusMilestoneDTO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="bus_id" jdbcType="BIGINT" property="busId" />
    <result column="task_id" jdbcType="VARCHAR" property="taskId" />
    <result column="task_def_id" jdbcType="VARCHAR" property="taskDefId" />
    <result column="current_task" jdbcType="VARCHAR" property="currentTask" />
    <result column="assigement_user" jdbcType="BIGINT" property="assigementUser" />
    <result column="assigement_user_name" jdbcType="VARCHAR" property="assigementUserName" />
    <result column="done_result" jdbcType="VARCHAR" property="doneResult" />
    <result column="done_remark" jdbcType="VARCHAR" property="doneRemark" />
    <result column="start_date" jdbcType="TIMESTAMP" property="startDate" />
    <result column="end_date" jdbcType="TIMESTAMP" property="endDate" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="customer_mobile" jdbcType="VARCHAR" property="customerMobile" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from bus_milestone
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.yepit.flow.bo.BusMilestone">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into bus_milestone (bus_id, task_id, task_def_id, 
      current_task, assigement_user, assigement_user_name, 
      done_result, done_remark, start_date, 
      end_date, `status`)
    values (#{busId,jdbcType=BIGINT}, #{taskId,jdbcType=VARCHAR}, #{taskDefId,jdbcType=VARCHAR}, 
      #{currentTask,jdbcType=VARCHAR}, #{assigementUser,jdbcType=BIGINT}, #{assigementUserName,jdbcType=VARCHAR}, 
      #{doneResult,jdbcType=VARCHAR}, #{doneRemark,jdbcType=VARCHAR}, #{startDate,jdbcType=TIMESTAMP}, 
      #{endDate,jdbcType=TIMESTAMP}, #{status,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.yepit.flow.bo.BusMilestone">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update bus_milestone
    set bus_id = #{busId,jdbcType=BIGINT},
      task_id = #{taskId,jdbcType=VARCHAR},
      task_def_id = #{taskDefId,jdbcType=VARCHAR},
      current_task = #{currentTask,jdbcType=VARCHAR},
      assigement_user = #{assigementUser,jdbcType=BIGINT},
      assigement_user_name = #{assigementUserName,jdbcType=VARCHAR},
      done_result = #{doneResult,jdbcType=VARCHAR},
      done_remark = #{doneRemark,jdbcType=VARCHAR},
      start_date = #{startDate,jdbcType=TIMESTAMP},
      end_date = #{endDate,jdbcType=TIMESTAMP},
      `status` = #{status,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, bus_id, task_id, task_def_id, current_task, assigement_user, assigement_user_name, 
    done_result, done_remark, start_date, end_date, `status`
    from bus_milestone
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, bus_id, task_id, task_def_id, current_task, assigement_user, assigement_user_name, 
    done_result, done_remark, start_date, end_date, `status`
    from bus_milestone
  </select>
  <select id="selectByCond" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, bus_id,task_id, task_def_id, current_task, assigement_user, assigement_user_name,
    done_result, done_remark,start_date, end_date, `status`
    from bus_milestone where task_id = #{pa.taskId} AND assigement_user = #{pa.assigementUser} and status = 0
  </select>
  <select id="listMilestoneByBusId" resultMap="BaseResultMap" >
  <!--
    WARNING - @mbg.generated
    This element is automatically generated by MyBatis Generator, do not modify.
  -->
  select id, bus_id, task_id,task_def_id, current_task, assigement_user, assigement_user_name,
  done_result, done_remark,start_date, end_date, `status`
  from bus_milestone where bus_id = #{busId}  order BY id
</select>
  <select id="queryMileStoneByBusIdAndTaskDefId" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, bus_id, task_id,task_def_id, current_task, assigement_user, assigement_user_name,
    done_result, done_remark,start_date, end_date, `status`
    from bus_milestone where bus_id = #{busId}  and task_def_Id= #{taskDefId} order BY id DESC
  </select>
  <select id="listTaskByUserId" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, bus_id, task_id,task_def_id, current_task, assigement_user, assigement_user_name,
    done_result, done_remark,start_date, end_date, `status`
    from bus_milestone where assigement_user = #{userId} and status = 0 order BY start_date
  </select>
  <select id="pageSearchTaskByUserId" resultMap="PageSearchResultMap" >
    select a.id, a.bus_id, a.task_id,a.task_def_id, a.current_task, a.assigement_user, a.assigement_user_name,
    a.done_result, a.done_remark,a.start_date, a.end_date, a.status,b.customer_name,b.customer_mobile
    from bus_milestone a
    left join bus_task b on a.bus_id = b.bus_id
    where assigement_user = #{userId} and a.status = 0 order BY start_date
  </select>

  <select id="getUserHisTaskByUserId" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT a.id, a.bus_id, a.task_id,a.task_def_id, a.current_task, a.assigement_user, a.assigement_user_name,
    a.done_result, a.done_remark,a.start_date, a.end_date, a.status
    FROM bus_milestone a,bus_task b WHERE a.bus_id = b.bus_id and a.assigement_user = #{assignUser} and b.status = #{status} order BY start_date desc
  </select>

  <select id="pageSearchUserHisTaskByUserId" resultMap="PageSearchResultMap" >
    SELECT a.id, a.bus_id, a.task_id,a.task_def_id, a.current_task, a.assigement_user, a.assigement_user_name,
    a.done_result, a.done_remark,a.start_date, a.end_date, a.status,b.customer_name,b.customer_mobile
    FROM bus_milestone a
	left join bus_task b on a.bus_id = b.bus_id
	where a.assigement_user = #{assignUser} and b.status = #{status}
	order BY start_date desc
  </select>

  <select id="myTaskCount" resultType="java.lang.Long" >
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select COUNT(DISTINCT bus_id)
    from bus_milestone where status = #{status}
    <if test="assignUser != null and assignUser !=''">
      and assigement_user = #{assignUser}
    </if>
  </select>

  <select id="pageSearchMileStone" resultMap="BaseResultMap" >
    select a.id, a.bus_id, a.task_id,a.task_def_id, a.current_task, a.assigement_user, a.assigement_user_name,
    a.done_result, a.done_remark,a.start_date, a.end_date, a.status
    from bus_milestone a
    where 1=1
    <if test="busId != null">
      and bus_id = #{busId}
    </if>
    <if test="taskId != null and taskId != ''">
      and task_id = #{taskId}
    </if>
  </select>
</mapper>